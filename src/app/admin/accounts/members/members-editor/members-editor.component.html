<ng-template #tplContent>
  <section class="editor-padding">
    <form class="editor" nz-form [formGroup]="dataForm" (ngSubmit)="submitForm($event)" (reset)="resetForm($event)">
      <h3>账号信息</h3>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>会员账号</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="usernameErrorTpl">
          <input nz-input formControlName="username" placeholder="请输入" autocomplete="off"/>
          <ng-template #usernameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              会员账号不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>会员昵称</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="nickErrorTpl">
          <input nz-input formControlName="nick" placeholder="请输入" autocomplete="off" />
          <ng-template #nickErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              会员昵称不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzRequired]="isCreated">密码</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="passwordErrorTpl">
          <input nz-input type="password" formControlName="password" placeholder="请输入" autocomplete="new-password">
          <ng-template #passwordErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              密码不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzRequired]="isCreated">确认密码</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="confirmPasswordErrorTpl">
          <input nz-input type="password" formControlName="confirmPassword" placeholder="请输入" autocomplete="new-password">
          <ng-template #confirmPasswordErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('equalTo')">
              两次输入的密码不一致
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzRequired]="isCreated">取款密码</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="paidPasswordErrorTpl">
          <input nz-input type="password" formControlName="paidPassword" placeholder="请输入" autocomplete="new-password">
          <ng-template #paidPasswordErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              取款密码不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" [nzRequired]="isCreated">确认取款密码</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="confirmPaidPasswordErrorTpl">
          <input nz-input type="password" formControlName="confirmPaidPassword" placeholder="请输入" autocomplete="new-password">
          <ng-template #confirmPaidPasswordErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('equalTo')">
              两次输入的密码不一致
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item *ngIf="isCreated">
        <nz-form-label [nzSpan]="6">所属代理</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="agentIdErrorTpl">
          <app-agent-selector formControlName="parentId" [notOptionalIds]="(oldData$ | async)?.id"></app-agent-selector>
          <ng-template #agentIdErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              所属代理不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>账号状态</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="isActiveErrorTpl">
          <nz-select formControlName="isActive">
            <nz-option *ngFor="let status of activeStatusesService.getFilterData()" [nzValue]="status.value"
                       [nzLabel]="status.text"></nz-option>
          </nz-select>
          <ng-template #isActiveErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              账号状态不得为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired>会员级别</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="isActiveErrorTpl">
          <nz-select formControlName="level" nzAllowClear>
            <nz-option *ngFor="let status of userLevelsService.getFilterData()" [nzValue]="status.value"
                       [nzLabel]="status.text"></nz-option>
          </nz-select>
          <ng-template #isActiveErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              会员级别不得为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <h3>会员资料</h3>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired >账号所属会员层</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="agentIdErrorTpl">
          <app-hierarchy-selector formControlName="hierarchyId" ></app-hierarchy-selector>
          <ng-template #agentIdErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              账号所属会员层不得为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6">真实姓名</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="realNameErrorTpl">
          <input nz-input formControlName="realName" placeholder="请输入" />
          <ng-template #realNameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              真实姓名不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item> <!--真实姓名-->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">QQ</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="QQErrorTpl">
          <input nz-input formControlName="QQ" placeholder="请输入" />
          <ng-template #QQErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              QQ不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item> <!--QQ-->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">E-MAIL</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="emailErrorTpl">
          <input nz-input formControlName="email" placeholder="请输入" />
          <ng-template #emailErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              E-MAIL不能为空
            </ng-container>
            <ng-container *ngIf="control.hasError('email')">
              E-MAIL不正确
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item> <!--E-MAIL-->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">银行账号</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="bankAccountErrorTpl">
          <input nz-input formControlName="bankAccount" placeholder="请输入" autocomplete="off"/>
          <ng-template #bankAccountErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              银行账号不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6">开户行网点</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="bankSubNameErrorTpl">
          <input nz-input formControlName="bankSubName" placeholder="请输入" />
          <ng-template #bankSubNameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              开户行网点不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6">所在省/市/区</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="areaCodeErrorTpl">
          <app-locations-selector formControlName="areaCode"></app-locations-selector>
          <ng-template #areaCodeErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              所在省/市/区不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item> <!--所在省/市/区-->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">备注</nz-form-label>
        <nz-form-control [nzSpan]="18" [nzErrorTip]="remarkErrorTpl">
          <textarea nz-input formControlName="remark" placeholder="请输入备注"></textarea>
          <ng-template #remarkErrorTpl let-control>
            <ng-container *ngIf="control.hasError('server')">
              {{ control.errors.server }}
            </ng-container>
            <ng-container *ngIf="control.hasError('required')">
              所在省/市/区不能为空
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item> <!--备注-->

      <nz-form-item class="editor-bottom">
        <input type="submit" nz-button nzType="primary" [value]="isCreated ? '保存' : '修改'"/>
        <input type="reset" nz-button value="取消"/>
      </nz-form-item>
    </form>
  </section>
</ng-template>

<app-operation-button *ngIf="isCreated" type="primary" (doTask)="openDialog($event, tplContent)">＋ 新增
</app-operation-button>
<app-table-operation-button *ngIf="!isCreated" (doTask)="openDialog($event, tplContent)">编辑</app-table-operation-button>
